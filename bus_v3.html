<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="theme-color" content="#41009b">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="æ¯›æ¯›æŸ¥å·´å£«">
  <link rel="manifest" href="https://ponglai-git.github.io/busList/manifest.json">
  <link rel="icon" href="https://ponglai-git.github.io/busList/192_icon.png" type="image/png" sizes="192x192">
  <link rel="apple-touch-icon" href="https://ponglai-git.github.io/busList/192_icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ¯›æ¯›è±¬å·´å£«åˆ°ç«™æŸ¥è©¢ç³»çµ±</title>
</head>
<body>

<div class="main">
  <!-- é ‚éƒ¨æ¨™é¡Œå€åŸŸ -->
  <div class="header">
    <p class="top_icon"><img src="icon.png"></p>
    <h1>å¯¦æ™‚å·´å£«åˆ°ç«™æŸ¥è©¢</h1>
    <div class="subtitle">æ¯›æ¯›è±¬å·´å£«åˆ°ç«™æŸ¥è©¢ç³»çµ±</div>
  </div>

  <!-- æŸ¥è©¢å€åŸŸ -->
  <div class="search-container">
    <div class="search-box">
      <div class="input">
      <div class="input-group">
        <label for="routeInput">è·¯ç·šè™Ÿç¢¼</label>
        <div class="input-wrapper">
          <input type="text" id="routeInput" placeholder="ä¾‹å¦‚: 76K" value="76K">
          <span class="input-icon">ğŸšŒ</span>
        </div>
      </div>

      <div class="input-group">
        <label for="bound">æ–¹å‘</label>
        <div class="select-wrapper">
          <select id="bound">
            <option value="inbound">å¾€ç¨‹</option>
            <option value="outbound">å›ç¨‹</option>
          </select>
          <span class="select-icon">â–¼</span>
        </div>
      </div>
    </div>

      <button class="search-btn" onclick="getStops()">
        <span class="btn-icon">ğŸ”</span>
        <span class="btn-text">æŸ¥è©¢è·¯ç·š</span>
      </button>
    </div>
  </div>

  <!-- çµæœå€åŸŸ -->
  <div id="result" class="result-container">
    <div class="empty-state">
      <div class="empty-icon">ğŸ“</div>
      <p>è¼¸å…¥è·¯ç·šè™Ÿç¢¼æŸ¥è©¢å·´å£«ç«™é»</p>
    </div>
  </div>

  <!-- é è…³ -->
  <div class="footer">
    <p>Copyright Â© 2026 PongLai. All rights reserved.</p>
    <p class="update-time">æœ€å¾Œæ›´æ–°æ™‚é–“: <span id="updateTime">--:--</span></p>
  </div>
</div>

<script>
    let stopMap = {};
    let currentRoute = '';
    let currentBound = '';

    // æ›´æ–°æ™‚é–“é¡¯ç¤º
    function updateTime() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('zh-HK', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: false 
        });
        document.getElementById('updateTime').textContent = timeStr;
    }

    // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡æ™‚é–“
    setInterval(updateTime, 60000);
    updateTime();

    async function getStops() {
      const route = document.getElementById("routeInput").value.trim().toUpperCase();
      const bound = document.getElementById("bound").value;
      const resultDiv = document.getElementById("result");
      
      // å„²å­˜ç•¶å‰æŸ¥è©¢
      currentRoute = route;
      currentBound = bound;

      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      resultDiv.innerHTML = `
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>æ­£åœ¨æŸ¥è©¢è·¯ç·š ${route}...</p>
        </div>
      `;

      try {
        // å–å¾—è·¯ç·šæ‰€æœ‰åˆ†ç«™
        const response = await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/route-stop/${route}/${bound}/1`);
        const data = await response.json();

        if (!data.data || data.data.length === 0) {
          resultDiv.innerHTML = `
            <div class="error-state">
              <div class="error-icon">âŒ</div>
              <h3>æ‰¾ä¸åˆ°æ­¤è·¯ç·š</h3>
              <p>è«‹ç¢ºèªè·¯ç·šè™Ÿç¢¼åŠæ–¹å‘æ˜¯å¦æ­£ç¢º</p>
              <button class="retry-btn" onclick="getStops()">é‡æ–°æŸ¥è©¢</button>
            </div>
          `;
          return;
        }

        // å…ˆå–å¾—æ‰€æœ‰ç«™é»åç¨±ï¼ˆå„ªåŒ–ï¼šä¸¦è¡Œè«‹æ±‚ï¼‰
        const stopsPromises = data.data.map(async (stop) => {
          const stopInfo = await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/stop/${stop.stop}`);
          return await stopInfo.json();
        });

        const stopsData = await Promise.all(stopsPromises);

        // æ§‹å»ºçµæœ
        let output = `
          <div class="route-header">
            <div class="route-info">
              <span class="route-number">${route}</span>
              <span class="route-direction">${bound === 'inbound' ? 'å¾€ç¨‹' : 'å›ç¨‹'}</span>
            </div>
            <div class="route-stats">å…± ${data.data.length} å€‹ç«™é»</div>
          </div>
          <div class="stops-list">
        `;
        
        data.data.forEach((stop, index) => {
          const info = stopsData[index].data;
          output += `
            <div class="stop-item">
              <div class="stop-header">
                <div class="stop-sequence">${index + 1}</div>
                <div class="stop-info">
                  <h3 class="stop-name">${info.name_tc}</h3>
                  <div class="stop-id">ç«™è™Ÿ: ${stop.stop} ( ${info.lat}, ${info.long} )</div>
                </div>
                <button class="eta-btn" onclick="getETA('${stop.stop}','${route}', '${stop.bound}', this)">
                  <span class="eta-btn-text">åˆ°ç«™æ™‚é–“</span>
                  <span class="eta-btn-icon">â±ï¸</span>
                </button>
              </div>
              <div class="eta-display" id="eta-${stop.stop}"></div>
            </div>
          `;
        });

        output += `</div>`;
        resultDiv.innerHTML = output;


	// å˜—è©¦è‡ªå‹•å®šä½ä¸¦è·³è½‰åˆ°æœ€è¿‘è»Šç«™
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition((pos) => {
        const userLat = pos.coords.latitude;
        const userLng = pos.coords.longitude;

        let minDist = Infinity;
        let nearestStopId = null;
        let nearestButton = null;

        // ç›´æ¥ä½¿ç”¨å·²ç¶“æŠ“å¥½çš„ stopsDataï¼Œä¸ç”¨å† fetch
        stopsData.forEach((stopInfo, index) => {
            const stop = data.data[index];
            const lat = parseFloat(stopInfo.data.lat);
            const lng = parseFloat(stopInfo.data.long);  // æ³¨æ„é€™è£¡æ˜¯ long ä¸æ˜¯ lng
            
            if (isNaN(lat) || isNaN(lng)) return;

            // Haversine å…¬å¼
            const R = 6371e3;
            const Ï†1 = userLat * Math.PI / 180;
            const Ï†2 = lat * Math.PI / 180;
            const Î”Ï† = (lat - userLat) * Math.PI / 180;
            const Î”Î» = (lng - userLng) * Math.PI / 180;

            const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const d = R * c;

            if (d < minDist) {
                minDist = d;
                nearestStopId = stop.stop;
                nearestButton = document.querySelector(`button[onclick*="'${stop.stop}'"]`);
            }
        });

        
        console.log(`æœ€è¿‘çš„ç«™é»æ˜¯ ${nearestStopId}ï¼Œè·é›¢ç´„ ${Math.round(minDist)} ç±³`);
        // å°æ–¼ 250 ç±³æ‰è·³è½‰
        if (minDist <= 300 && nearestButton) {
            nearestButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
			const type = bound === 'inbound' ? 'I' : 'O';
            getETA(nearestStopId, route, type, nearestButton);
        }
    }, () => {
        // å®šä½å¤±æ•—ï¼Œä¸åšäº‹
        console.log('å®šä½å¤±æ•—æˆ–ç”¨æˆ¶æ‹’çµ•');
    });
}

      } catch (error) {
        resultDiv.innerHTML = `
          <div class="error-state">
            <div class="error-icon">âš ï¸</div>
            <h3>æŸ¥è©¢å¤±æ•—</h3>
            <p>è«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥å¾Œå†è©¦</p>
            <button class="retry-btn" onclick="getStops()">é‡è©¦</button>
          </div>
        `;
        console.error(error);
      }
    }

    async function getETA(stopId, route, type, button) {
		console.log("ETA",stopId, route, type, button)
      const etaDiv = document.getElementById(`eta-${stopId}`);
      
      // é˜²æ­¢é‡è¤‡é»æ“Š
      if (button.classList.contains('loading')) return;
      
      button.classList.add('loading');
      etaDiv.innerHTML = `
        <div class="eta-loading">
          <div class="loading-dots">
            <span></span><span></span><span></span>
          </div>
          æŸ¥è©¢ä¸­...
        </div>
      `;

      try {
        const etaResponse = await fetch(`https://data.etabus.gov.hk/v1/transport/kmb/eta/${stopId}/${route}/1`);
        const etaData = await etaResponse.json();

        if (!etaData.data || etaData.data.length === 0) {
          etaDiv.innerHTML = '<div class="no-eta">æš«ç„¡åˆ°ç«™æ™‚é–“è³‡è¨Š</div>';
          button.classList.remove('loading');
          return;
        }

        let now = new Date();
        let upcomingBuses = [];
        
        etaData.data.forEach(e => {
          if (e.eta && e.dir == type) {
            let etaTime = new Date(e.eta);
            let diffMin = Math.floor((etaTime - now) / 60000);
            if(diffMin >= 0 && diffMin <= 120) { // åªé¡¯ç¤ºæœªä¾†2å°æ™‚å…§çš„ç­æ¬¡
              upcomingBuses.push({
                minutes: diffMin,
                time: etaTime.toLocaleTimeString('zh-HK', { 
                  hour: '2-digit', 
                  minute: '2-digit',
                  hour12: false 
                }),
                remark: e.rmk_tc || ''
              });
            }
          }
        });

        if (upcomingBuses.length === 0) {
          etaDiv.innerHTML = '<div class="no-eta">æœªä¾†2å°æ™‚å…§æ²’æœ‰ç­æ¬¡</div>';
        } else {
          // æŒ‰æ™‚é–“æ’åº
          upcomingBuses.sort((a, b) => a.minutes - b.minutes);
          
          let output = '<div class="eta-results">';
          upcomingBuses.forEach((bus, index) => {
            let timeClass = 'eta-time';
            if (bus.minutes <= 3) timeClass += ' eta-imminent';
            else if (bus.minutes <= 10) timeClass += ' eta-soon';
            
            output += `
              <div class="eta-item ${index === 0 ? 'eta-next' : ''}">
                <div class="${timeClass}">
                  <span class="eta-minutes">${bus.minutes}</span>
                  <span class="eta-unit">åˆ†é˜</span>
                </div>
                <div class="eta-details">
                  <div class="eta-clock">${bus.time}</div>
                  ${bus.remark ? `<div class="eta-remark">${bus.remark}</div>` : ''}
                </div>
              </div>
            `;
          });
          output += '</div>';
          etaDiv.innerHTML = output;
        }

        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        button.classList.remove('loading');
        button.classList.add('checked');
        button.innerHTML = '<span class="eta-btn-text">å·²æ›´æ–°</span><span class="eta-btn-icon">âœ…</span>';

        // 5ç§’å¾Œæ¢å¾©æŒ‰éˆ•ç‹€æ…‹
        setTimeout(() => {
          button.classList.remove('checked');
          button.innerHTML = '<span class="eta-btn-text">åˆ°ç«™æ™‚é–“</span><span class="eta-btn-icon">â±ï¸</span>';
        }, 5000);

      } catch (error) {
        etaDiv.innerHTML = '<div class="eta-error">æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        button.classList.remove('loading');
        console.error(error);
      }
    }

    // é»æ“ŠEnteréµæŸ¥è©¢
    document.getElementById('routeInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        getStops();
      }
    });

// åœ¨ç¾æœ‰ script ä¸­åŠ å…¥é€™å¹¾è¡Œå°±å¤ äº†
document.addEventListener('DOMContentLoaded', function() {
    // å¸¸ç”¨è·¯ç·šåˆ—è¡¨ï¼ˆç²¾ç°¡ç‰ˆï¼‰

    const commonRoutes = [
  // å¸‚å€è·¯ç·š (1â€“99)
  '1', '1A', '2', '2A', '2B', '2D', '2E', '2F', '3B', '3C', '3D', '3M', '3X',
  '5', '5A', '5C', '5D', '5M', '6', '6C', '6D', '6F', '7', '7B', '7M', '8',
  '9', '10', '11', '12', '13X', '14', '15', '16', '17', '18', '21', '23',
  '24', '26', '27', '28', '29M', '31', '32', '33', '34', '35', '36', '37',
  '38', '39M', '40', '41', '42', '43', '44', '45', '46', '47X', '48X', '49X',
  '52X', '53', '54', '55', '56', '57M', '58M', '59M', '60M', '61M', '62X',
  '63X', '64K', '65K', '66M', '67M', '68X', '69M', '70K', '71K', '72', '73',
  '74X', '75K', '76K', '77K', '78', '79K', '80K', '81', '82K', '83K', '84M',
  '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '95', '96',
  '97', '98', '99',

  // æ–°ç•Œè·¯ç·š (100â€“199)
  '101', '102', '103', '104', '106', '107', '108', '109', '110', '111', '112',
  '113', '116', '117', '118', '170', '171', '182',

  // 200 ç³»åˆ—
  '234', '234X', '278X',

  // 600 ç³»åˆ—
  '601', '603', '606', '608', '613', '619', '621', '641', '671', '673',
  '680', '681', '682', '690', '694',

  // 900 ç³»åˆ—
  '904', '905', '914', '948', '960', '961', '962', '968', '969', '978',

  // æ©Ÿå ´å¿«ç·š A ç³»åˆ—
  'A31', 'A32', 'A33', 'A34', 'A36', 'A37', 'A41', 'A43', 'A47X',

  // æ©Ÿå ´ç‰¹å¿« E ç³»åˆ—
  'E31', 'E32', 'E33', 'E34', 'E41', 'E42',

  // é€šå®µè·¯ç·š N ç³»åˆ—
  'N216', 'N241', 'N260', 'N269', 'N281', 'N293', 'N296', 'N368', 'N373',
  'N680', 'N691', 'N968', 'N969'
];
    
    // å‰µå»º datalist
    let datalist = document.getElementById('busRoutes');
    if (!datalist) {
        datalist = document.createElement('datalist');
        datalist.id = 'busRoutes';
        document.body.appendChild(datalist);
        
        // åŠ å…¥é¸é …
        commonRoutes.forEach(route => {
            let option = document.createElement('option');
            option.value = route;
            datalist.appendChild(option);
        });
        
        // ç¶å®šåˆ°è¼¸å…¥æ¡†
        const routeInput = document.getElementById('routeInput');
        routeInput.setAttribute('list', 'busRoutes');
    }
});
</script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
  min-height: 100vh;
  color: #333;
  line-height: 1.6;
}

.main {
  max-width: 640px;
  margin: 0 auto;
  padding: 20px;
  background: white;
  min-height: 100vh;
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
}

/* é ‚éƒ¨æ¨™é¡Œ */
.header {
  text-align: left;
  padding: 10px 0 20px;
  background: linear-gradient(135deg, #41009b 0%, #2a0066 100%);
  margin: -20px -20px 30px;
  border-radius: 0 0 20px 20px;
  color: white;
  position: relative;
  overflow: hidden;
}
.top_icon {
    display: block;
    float: left;
    border-radius: 100%;
    overflow: hidden;
    width: 20%;
    margin: 0 8%;
    position: relative;
    z-index: 2;
}
.top_icon img {
  display: block;
  width: 100%;
}

.header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px);
  background-size: 20px 20px;
  animation: moveBg 20s linear infinite;
}

@keyframes moveBg {
  0% { transform: translate(0, 0) rotate(0deg); }
  100% { transform: translate(20px, 20px) rotate(360deg); }
}

.kmb-logo {
  font-size: 24px;
  font-weight: bold;
  background: rgba(255, 255, 255, 0.2);
  width: 60px;
  height: 60px;
  line-height: 60px;
  border-radius: 50%;
  margin: 0 auto 15px;
  border: 3px solid rgba(255, 255, 255, 0.3);
}

.header h1 {
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
  letter-spacing: 1px;
}

.subtitle {
  font-size: 14px;
  opacity: 0.9;
  font-weight: 300;
}

/* æœå°‹å€åŸŸ */
.search-container {
  margin-bottom: 30px;
}

.search-box {
  display: block;
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 8px 25px rgba(65, 0, 155, 0.1);
  border: 1px solid rgba(65, 0, 155, 0.1);
}
.search-box .input {
  display: flex;
  gap: 15px;
}

.input-group {
  margin-bottom: 20px;
  width: 50%;
  box-sizing: border-box;
}

.input-group label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: #41009b;
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.input-wrapper, .select-wrapper {
  position: relative;
}

.input-wrapper input, .select-wrapper select {
  width: 100%;
  padding: 16px 50px 16px 20px;
  font-size: 20px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  background: #f8f9fa;
  transition: all 0.3s ease;
  font-weight: 500;
  color: #333;
}

.input-wrapper input:focus, .select-wrapper select:focus {
  outline: none;
  border-color: #41009b;
  background: white;
  box-shadow: 0 0 0 3px rgba(65, 0, 155, 0.1);
}

.input-icon, .select-icon {
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 20px;
  color: #666;
}

.select-icon {
  pointer-events: none;
}

.search-btn {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, #41009b 0%, #2a0066 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  transition: all 0.3s ease;
  margin-top: 10px;
}

.search-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(65, 0, 155, 0.3);
}

.search-btn:active {
  transform: translateY(0);
}

.btn-icon {
  font-size: 20px;
}

/* çµæœå€åŸŸ */
.result-container {
  min-height: 200px;
}

.empty-state, .loading-state, .error-state {
  text-align: center;
  padding: 50px 20px;
  color: #666;
}

.empty-icon, .error-icon {
  font-size: 50px;
  margin-bottom: 20px;
  opacity: 0.5;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #41009b;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* è·¯ç·šæ¨™é¡Œ */
.route-header {
  background: linear-gradient(135deg, #f8f5ff 0%, #eef2ff 100%);
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 1px solid rgba(65, 0, 155, 0.1);
}

.route-info {
  display: flex;
  align-items: center;
  gap: 15px;
}

.route-number {
  font-size: 32px;
  font-weight: 800;
  color: #41009b;
  background: white;
  min-width: 70px;
  height: 70px;
  line-height: 70px;
  text-align: center;
  border-radius: 50%;
  box-shadow: 0 4px 15px rgba(65, 0, 155, 0.2);
  border: 3px solid #41009b;
    padding: 0 10px;
    box-sizing: border-box;
}

.route-direction {
  font-size: 16px;
  font-weight: 600;
  color: #41009b;
  background: rgba(65, 0, 155, 0.1);
  padding: 6px 15px;
  border-radius: 20px;
}

.route-stats {
  font-size: 14px;
  color: #666;
  background: white;
  padding: 8px 15px;
  border-radius: 20px;
  font-weight: 500;
}

/* ç«™é»åˆ—è¡¨ */
.stops-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.stop-item {
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
  border: 1px solid #eee;
  transition: transform 0.3s ease;
}

.stop-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.stop-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.stop-sequence {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, #41009b 0%, #2a0066 100%);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 18px;
  flex-shrink: 0;
}

.stop-info {
  flex: 1;
}

.stop-name {
  font-size: 18px;
  font-weight: 600;
  color: #333;
  margin-bottom: 4px;
  line-height: 1.4;
}

.stop-id {
  font-size: 12px;
  color: #666;
  font-family: monospace;
  background: #f5f5f5;
  padding: 2px 8px;
  border-radius: 10px;
  display: inline-block;
}

.eta-btn {
  padding: 12px 20px;
  background: linear-gradient(135deg, #00c853 0%, #00a844 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.eta-btn:hover:not(.loading):not(.checked) {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 200, 83, 0.3);
}

.eta-btn.loading {
  opacity: 0.7;
  cursor: not-allowed;
}

.eta-btn.checked {
  background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
}

/* ETA é¡¯ç¤ºå€åŸŸ */
.eta-display {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #eee;
}

.eta-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  color: #666;
  font-size: 14px;
}

.loading-dots span {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #41009b;
  margin: 0 2px;
  animation: bounce 1.4s infinite ease-in-out both;
}

.loading-dots span:nth-child(1) { animation-delay: -0.32s; }
.loading-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0); }
  40% { transform: scale(1.0); }
}

.eta-results {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.eta-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 12px;
  border-left: 4px solid #ddd;
}

.eta-item.eta-next {
  background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
  border-left-color: #00c853;
}

.eta-time {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 80px;
  padding: 8px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.eta-imminent .eta-minutes {
  color: #f44336;
  animation: pulse 2s infinite;
}

.eta-soon .eta-minutes {
  color: #ff9800;
}

.eta-minutes {
  font-size: 28px;
  font-weight: 800;
  color: #41009b;
  line-height: 1;
}

.eta-unit {
  font-size: 12px;
  color: #666;
  margin-top: 2px;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.eta-details {
  flex: 1;
}

.eta-clock {
  font-size: 14px;
  color: #333;
  font-weight: 500;
  margin-bottom: 4px;
}

.eta-remark {
  font-size: 12px;
  color: #666;
  background: rgba(0, 0, 0, 0.05);
  padding: 4px 8px;
  border-radius: 6px;
  display: inline-block;
}

.no-eta, .eta-error {
  text-align: center;
  padding: 20px;
  color: #666;
  background: #f5f5f5;
  border-radius: 12px;
  font-size: 14px;
}

/* é‡è©¦æŒ‰éˆ• */
.retry-btn {
  margin-top: 20px;
  padding: 12px 30px;
  background: #41009b;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.retry-btn:hover {
  background: #2a0066;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(65, 0, 155, 0.3);
}

/* é è…³ */
.footer {
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid #eee;
  text-align: center;
  font-size: 12px;
  color: #666;
}

.update-time {
  margin-top: 8px;
  font-size: 11px;
  color: #999;
}

/* éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 480px) {
  .main {
    padding: 15px;
  }
  
  .header {
    margin: -15px -15px 20px;
    padding: 15px 0 25px;
  }
  
  .header h1 {
    font-size: 24px;
  }
  
  .search-box {
    padding: 15px;
  }
  
  .input-wrapper input, .select-wrapper select {
    font-size: 18px;
    padding: 14px 45px 14px 15px;
  }
  
  .route-header {
    gap: 15px;
    text-align: center;
  }
  
  .route-info {
    gap: 10px;
  }
  
  .stop-header {
    flex-wrap: wrap;
  }
  
  .eta-btn {
    width: 100%;
    justify-content: center;
    margin-top: 10px;
  }
  
  .eta-item {
    text-align: center;
    gap: 10px;
  }
  
  .eta-time {
    width: 50%;
  }
}
</style>  
</body>
</html>